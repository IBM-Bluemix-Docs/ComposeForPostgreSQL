---
copyright:
  years: 2016,2018
lastupdated: "2018-06-12"
---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:tip: .tip}

# アーキテクチャー 
{: #architecture}

## 複製

{{site.data.keyword.composeForPostgreSQL_full}} サービスには、2 つのデータ・メンバー (リーダーとフォロワー・メンバー) で構成される 1 つのクラスターがあります。 データは両方のデータ・メンバーに複製され、それらのディスク・スペースは領域のアベイラビリティー・ゾーンに分散されます。  高可用性は Patroni を使用して管理されます。3 つの etcd アービターでクラスターの状態の保守、複製の管理、フェイルオーバーの処理を行います。 1 つのデータ・メンバーが到達不能になっても、クラスターは引き続き正常に作動します。

## ディスクの暗号化

すべての {{site.data.keyword.composeForPostgreSQL}} サービスには、保存時の暗号化機能があります。 データは、ボリューム・レベルの暗号化が有効になっているサーバー上に配置されます。 

{{site.data.keyword.composeForPostgreSQL}} はマネージド・サービスであるので、{{site.data.keyword.cloud}} Compose のオペレーターはデータを見ることができます。 ディスクの暗号化に加えて、個人情報を暗号化してからデータベース内に保管するか、データベース自体に対して暗号化を有効にする拡張機能または機能を使用することをお勧めします。 これらの方法は使いやすさやパフォーマンスに影響することがありますが、個人情報を暗号化で保護するのは良い習慣です。

## 自動スケーリング

リソースは、PostgreSQL データベースのディスク・ストレージ合計使用量に基づいて自動的にスケーリングされます。 メモリーは、プロビジョンされるディスク・スペースとの比率が 1:4 になるように調整されます。 これらのリソースはユニットとしてバンドルされます。

自動スケーリングは、データベースの短期間から中期間のトレンドに対応するように設計されています。 サービスは 1 時間ごとに検査され、ディスク・スペースが不足している場合は、追加のユニットがデプロイメントに割り振られます。 

自動スケーリングにより、ディスク/メモリー使用量が縮小したデプロイメントのスケールが縮小されることはありません。 データベースにプロビジョンされたリソースは、将来の必要に備えて、手動でデプロイメントを縮小しない限り保持されます。
{: .tip}

## 役割

PostgreSQL サービスはすべて「管理者」役割を使用してプロビジョンされます。 psql を使用して、その他の役割や許可を追加したり管理したりできます。 このサービスには「スーパーユーザー」役割はありません。

## データベースの拡張機能

psql を使用して、PostgreSQL 拡張機能のリスト表示、インストール、管理を行うことができます。

CREATE コマンドと ALTER コマンドを実行するには、提供されている「管理者」役割を使用する必要があります。 {: .tip}

### 拡張機能のリスト表示

サポートされている拡張機能の完全なリストを取得するには、pg_available_extensions を使用します。
`SELECT name FROM pg_available_extensions;`

### 拡張機能のインストール

拡張機能をインストールするには、CREATE extension を使用します。
`CREATE extension <name> ;`

### 拡張機能の更新

新バージョンの拡張機能をインストールするには、ALTER EXTENSION を使用します。
`ALTER EXTENSION <name> UPDATE TO <version>;`
